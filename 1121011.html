<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Opinion Leaders Social Network Analysis</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        /* Add styles to set the dropdown width */
        #authorDropdown {
            width: 150px;
        }

        /* Remove width and height attributes from the SVG container */
        #graph-svg-container {
            /* Remove the original width and height attributes */
        }
    </style>
</head>
<body>

<!-- Add a container to render the graph -->
<div id="graph-container">
    <h1>Key Opinion Leaders Social Network Analysis</h1>
    <p>This is a dynamic network visualization of collaboration among authors.</p>

    <!-- Add control buttons -->
    <div>
        <label>Show/Hide Author Names:</label>
        <input type="checkbox" id="showHideAuthorNames" checked>

        <!-- Move the dropdown menu here -->
        <select id="authorDropdown">
            <option value="network_data.json">Tomohiro Fukuda</option>
            <option value="graph2_data.json">Marc Aurel Schnabel</option>
            <option value="graph3_data.json">Matthias Hank Haeusler</option>
            <option value="selected_authors_subgraph_data.json">Selected Authors</option>
            <option value="graph4_data.json">Three author</option>
            <option value="graph5_data.json">All author</option>
            <option value="d3_json_subgraph.json">Social Network Analysis</option>
            <!-- Add more options for other authors -->
        </select>
    </div>

    <!-- Modify the width and height of the SVG container -->
    <div id="graph-svg-container" style="width: 100%; height: 100vh;"></div>
</div>

<script>
// Update the selected author
function updateAuthorSelection() {
    var selectedFile = authorDropdown.property("value");
    // Perform actions based on the selected JSON file
    d3.json(selectedFile).then(function(newData) {
        // Add actions to display the new data
        console.log("Selected File:", selectedFile);
        console.log("New Data:", newData);

        // Remove the previous SVG
        d3.select("#graph-svg-container").select("svg").remove();

        // Load the new data
        loadData(selectedFile);
    }).catch(function(error) {
        console.error("Error loading data:", error);
    });
}

// Load data
function loadData(file) {
    d3.json(file).then(function(data) {
        // Create the SVG element
        var svg = d3.select("#graph-svg-container")
                    .append("svg")
                    .attr("width", 2000)
                    .attr("height", 2000);

        // Create the force-directed graph
        var simulation = d3.forceSimulation(data.nodes)
                           .force("link", d3.forceLink(data.links).id(function(d) { return d.id; }))
                           .force("charge", d3.forceManyBody().strength(-50))
                           .force("center", d3.forceCenter(1000, 500))  // Adjust the position here
                           .force("collide", d3.forceCollide().radius(10).strength(0.5))
                           .on("tick", ticked);

        // Create a color scale
        var colorScale = d3.scaleLinear()
                           .domain([0, 1])  // Assuming the range of degree centrality is [0, 1]
                           .range(["lightblue", "orange"]);

        // Add edges
        var link = svg.selectAll("line")
                      .data(data.links)
                      .enter().append("line")
                      .style("stroke", "gray");  // Set the edge color to gray

        // Add nodes
        var node = svg.selectAll("circle")
                      .data(data.nodes)
                      .enter().append("circle")
                      .attr("r", function(d) { return 5 + d.degree_centrality * 20; })  // Adjust the node size based on degree centrality
                      .style("fill", function(d) { return colorScale(d.degree_centrality); })  // Set the node color based on degree centrality
                      .call(d3.drag()  // Add drag behavior
                          .on("start", dragstarted)
                          .on("drag", dragged)
                          .on("end", dragended));

        // Add node labels
        var label = svg.selectAll(null)
                      .data(data.nodes)
                      .enter().append("text")
                      .text(function(d) { return d.id + " (" + d.degree_centrality.toFixed(2) + ")"; })  // Display node ID and degree centrality value
                      .attr("font-size", 8)
                      .attr("dx", 12)
                      .attr("dy", 4)
                      .style("fill", "black");  // Set the color of node labels to black

        function ticked() {
            link.attr("x1", function(d) { return d.source.x; })
                .attr("y1", function(d) { return d.source.y; })
                .attr("x2", function(d) { return d.target.x; })
                .attr("y2", function(d) { return d.target.y; });

            node.attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; });

            label.attr("x", function(d) { return d.x; })
                 .attr("y", function(d) { return d.y; });

            // Control the visibility of node labels
            label.style("display", function(d) {
                return document.getElementById("showHideAuthorNames").checked ? "block" : "none";
            });
        }

        function dragstarted(d) {
            if (!d3.event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(d) {
            d.fx = d3.event.x;
            d.fy = d3.event.y;
        }

        function dragended(d) {
            if (!d3.event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    });
}

// Get control button elements
var showHideAuthorNamesCheckbox = d3.select("#showHideAuthorNames");
var authorDropdown = d3.select("#authorDropdown");

// Listen for button state changes
showHideAuthorNamesCheckbox.on("change", updateAuthorNamesVisibility);

// Update author name display
function updateAuthorNamesVisibility() {
    d3.selectAll("text").style("display", function(d) {
        return showHideAuthorNamesCheckbox.property("checked") ? "block" : "none";
    });
}

// Listen for dropdown menu changes
authorDropdown.on("change", updateAuthorSelection);

// Initialize data loading
loadData("d3_json_subgraph.json");

</script>

</body> 
</html>
